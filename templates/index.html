<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <title>TaskMania</title>
  </head>
  <body>
    <div class="container-fluid mt-3 p-3 %">
      <div class="row">
        <!-- Form Column -->
        <div class="col-4">
          {% with messages = get_flashed_messages(with_categories=true) %} {% if
          messages %}
          <div
            class="alert"
            style="color: {% if category == 'success' %}green{% elif category == 'danger' %}red{% else %}black{% endif %}"
          >
            {% for category, message in messages %} {{ message }} {% endfor %}
          </div>

          {% endif %} {% endwith %}

          <div class="card">
            <div class="card-body">
              <form
                action="{{ url_for('index') }}"
                method="post"
                class="index-form"
              >
                {{ form.hidden_tag() }}
                <div class="mb-3">{{ form.title(class='form-control') }}</div>
                <div class="mb-3">
                  {{ form.description(class='form-control',rows=4,cols=40) }}
                </div>
                <div class="mb-3">{{ form.category(class='form-select') }}</div>
                <div class="mb-3">
                  {{ form.date_due.label(class='form-label') }} {{
                  form.date_due(class='form-control' + (' is-invalid' if
                  form.date_due.errors else '')) }} {% for error in
                  form.date_due.errors %}
                  <div class="invalid-feedback">{{ error }}</div>
                  {% endfor %}
                </div>
                <div class="d-grid">
                  {{ form.submit(class='btn btn-success ') }}
                </div>
              </form>
            </div>
          </div>
        </div>

        <!-- Tasks Column -->
        <div class="col-8">
          <h1 class="text-center">Tasks</h1>

          <div class="table-responsive">
            <table class="table table-bordered">
              <thead>
                <tr>
                  <th>Status</th>
                  <th>Title</th>
                  <th>Description</th>
                  <th>Details</th>

                  <th>Action</th>
                </tr>
              </thead>

              {% for task in tasks %}
              <tbody>
                <tr>
                  <td>
                    <form
                      action="{{ url_for('update_task_status', task_id=task.id) }}"
                      method="post"
                    >
                      <input
                        type="checkbox"
                        name="completed"
                        class="form-check-input ms-3"
                        {%
                        if
                        task.status
                        %}
                        checked
                        {%
                        endif
                        %}
                        onchange="this.form.submit()"
                      />
                    </form>
                  </td>
                  <td>{{ task.title }}</td>
                  <td>{{ task.description }}</td>
                  <td class="ps-3">
                    <small class="row text-center">
                      Date created:
                      <span class="no-wrap">{{ task.date_created}}</span>
                    </small>
                    <small class="row text-center">
                      Date due:
                      <span class="no-wrap">{{ task.date_due}}</span>
                    </small>
                  </td>
                  <td>
                    <div class="d-grid gap-1">
                      <form
                        action="{{ url_for('edit_task', task_id=task.id) }}"
                        method="get"
                        class="d-grid"
                      >
                        <button
                          type="submit"
                          class="btn btn-warning btn-sm mb-2"
                        >
                          Edit
                        </button>
                      </form>
                      <form
                        action="{{ url_for('delete_task', task_id=task.id) }}"
                        method="post"
                        class="d-grid"
                      >
                        <button type="submit" class="btn btn-danger btn-sm">
                          Delete
                        </button>
                      </form>
                    </div>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    <a href="{{ url_for('logout') }}">Logout</a>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
      crossorigin="anonymous"
    ></script>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const alert = document.querySelector('.alert'); // Select the alert div
        if (alert) {
          setTimeout(function() {
            alert.style.display = 'none'; // Hide the alert after 2 seconds
          }, 2000); // 2000 milliseconds = 2 seconds
        }
      });
    </script
  </body>
</html>
